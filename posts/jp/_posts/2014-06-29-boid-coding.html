---
layout: post
title:  "初めてのBoids  with JavaScript"
date:   2014-06-29
categories: [javascript, canvas]
---

<h3>Boidsって</h3>

<p>Boidsとは鳥の群行動をシミュレーションするアルゴリズムです。1986年、Craig
    Reynoldsによって発表されました。
    詳細は<a href="http://en.wikipedia.org/wiki/Boids">Wiki</a>にて、、</p>

<p>boidsを実現するにあたり3つの基本ルールがあるそうです。</p>

<ul>
    <li>Separation: 群が密集しすぎないようにする。</li>
    <li>Alignment: 群の速度が平均化する。</li>
    <li>Cohesion: 群の位置が平均化する。</li>
</ul>

<p>説明だけだとわかりにくいので、Boidsに関する擬似コードを参考にしながら、実装していきます。<a
        href="http://www.kfish.org/boids/pseudocode.html">http://www.kfish.org/boids/pseudocode.html</a>を参考にして作成しました。</p>

<h3>Boids Psuedcode</h3>
<p>Boidsプログラムは以下のように実装します。</p>

{% highlight javascript %}
init();
loop()

function init(){
    // initialize the boids
}

function loop(){
    // simulation boids
    update_boids();

    // draw boids
    draw_boids();

    requestAnimationFrame(loop);
}

{% endhighlight %}

<p>update_boids()の中では以下のように3つのルールを適用します。</p>

{% highlight javascript %}
function update_boids(){

    for(var i = 0; i < boids.length; i++){
        var boid = boids[i];
        // apply rule1
        rule1(i);

        // apply rule2
        rule2(i);

        // apply rule3
        rule3(i);
    }

}

{% endhighlight %}

<p>それぞれのルールについてこれ以降見ていきます。</p>

<h2>ルール1: Boids try to fly towards the centre of mass of neighbouring boids.</h2>

{% highlight javascript %}
functino rule1(index){
        var c = {x: 0, y: 0}
        for(var i = 0; i < boids.length; i++){
            if(i != index){
                c.x += boids[i].x;
                c.y += boids[i].y;
            }
        }

        c.x = c.x / NUM_BOIDS_EXC;
        c.y = c.y / NUM_BOIDS_EXC;

        boids[index].vx += (c.x - boids[index].x)/100;
        boids[index].vy += (c.y - boids[index].y)/100;
                        
}
{% endhighlight %}

<h2>ルール2: Boids try to keep a small distance away from other objects</h2>

{% highlight javascript %}
function rule2(index){
    for( var i = 0; i < boids.length; i++){
        var d = getDistance(boids[i], boids[index]);
        if(d < BOID_SIDE){
            boids[index].vx -= boids[i].x - boids[index].x;
            boids[index].vy -= boids[i].y - boids[index].y;
        }
    }
}
{% endhighlight %}


<h2>ルール3: Boids try to match velocity with near boids.</h2>

{% highlight javascript %}
function rule3(index){
    var pv = {x: 0, y: 0};
    for(var i = 0; i < boids.length; i++){
        if(i != index){
            pv.x += boids[i].vx;
            pv.y += boids[i].vy;
        }
    }

    pv.x /= NUM_BOIDS_EXC;
    pv.y /= NUM_BOIDS_EXC;

    boids[index].vx += (pv.x - boids[index].vx) / 8;
    boids[index].vy += (pv.y - boids[index].vy) / 8;
}
{% endhighlight %}

<h2>サンプル</h2>
<p data-height="268" data-theme-id="4918" data-slug-hash="yLFwi" data-default-tab="result" class='codepen'>See the Pen <a href='http://codepen.io/kenjiSpecial/pen/yLFwi/'>day28: boid animaion.</a> by Kenji Saito (<a href='http://codepen.io/kenjiSpecial'>@kenjiSpecial</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//codepen.io/assets/embed/ei.js"></script>

<p></br>てなかんじです。。</p>

